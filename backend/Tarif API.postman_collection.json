{
	"info": {
		"_postman_id": "cda6e5dd-cd17-488a-ba54-02a12a776b0b",
		"name": "Tarif API",
		"description": "Tarifin Tarifi backend test koleksiyonu ‚Äî public Recipes, Categories, Comments ve Reactions mod√ºlleri + AI seed",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "20528167",
		"_collection_link": "https://www.postman.com/red-eclipse-24199/workspace/orhan/collection/20528167-cda6e5dd-cd17-488a-ba54-02a12a776b0b?action=share&source=collection_link&creator=20528167"
	},
	"item": [
		{
			"name": "0) Seed",
			"item": [
				{
					"name": "AI Generate & Save (Seed Recipe)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status 201\", function () { pm.response.to.have.status(201); });",
									"let json = {};",
									"try { json = pm.response.json(); } catch(e) {}",
									"const data = json && json.data ? json.data : {};",
									"// recipeId",
									"if (data && data._id) pm.collectionVariables.set(\"recipeId\", String(data._id));",
									"// recipeSlug: lang->slug[lang] -> slug.en -> slugCanonical",
									"const lang = pm.collectionVariables.get('lang') || 'tr';",
									"let slug = (data.slug && (data.slug[lang] || data.slug.en)) || data.slugCanonical;",
									"if (slug) pm.collectionVariables.set('recipeSlug', String(slug));",
									"pm.test(\"Seed set recipeId\", () => pm.collectionVariables.get('recipeId'));",
									"pm.test(\"Seed set recipeSlug\", () => pm.collectionVariables.get('recipeSlug'));"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "x-lang",
								"value": "{{lang}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"prompt\": \"Kombu cayi tarifi verir misin? \"\n}"
						},
						"url": {
							"raw": "{{base_url}}/recipes/generate",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"recipes",
								"generate"
							]
						},
						"description": "LLM ile tarif olu≈üturur ve DB'ye kaydeder. recipeId/recipeSlug deƒüi≈ükenlerini test script'i set eder."
					},
					"response": []
				}
			]
		},
		{
			"name": "Recipes (Public)",
			"item": [
				{
					"name": "List Recipes",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status 200\", function () { pm.response.to.have.status(200); });",
									"const json = pm.response.json();",
									"pm.test(\"Has data array\", function(){ pm.expect(Array.isArray(json.data)).to.be.true; });",
									"if (Array.isArray(json.data) && json.data.length) {",
									"  const first = json.data[0];",
									"  if (first._id && !pm.collectionVariables.get('recipeId')) pm.collectionVariables.set('recipeId', String(first._id));",
									"  const lang = pm.collectionVariables.get('lang') || 'tr';",
									"  const slug = (first.slug && (first.slug[lang] || first.slug.en)) || first.slugCanonical;",
									"  if (slug && !pm.collectionVariables.get('recipeSlug')) pm.collectionVariables.set('recipeSlug', String(slug));",
									"}"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "x-lang",
								"value": "{{lang}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/recipes?limit=10&q=&tag=&maxTime=50",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"recipes"
							],
							"query": [
								{
									"key": "limit",
									"value": "10"
								},
								{
									"key": "q",
									"value": ""
								},
								{
									"key": "tag",
									"value": ""
								},
								{
									"key": "maxTime",
									"value": "50"
								}
							]
						},
						"description": "Public liste: q, tag, maxTime, limit senaryolarƒ±nƒ± test eder."
					},
					"response": []
				},
				{
					"name": "List Recipes Category",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status 200\", function () { pm.response.to.have.status(200); });",
									"const json = pm.response.json();",
									"pm.test(\"Has data array\", function(){ pm.expect(Array.isArray(json.data)).to.be.true; });",
									"if (Array.isArray(json.data) && json.data.length) {",
									"  const first = json.data[0];",
									"  if (first._id && !pm.collectionVariables.get('recipeId')) pm.collectionVariables.set('recipeId', String(first._id));",
									"  const lang = pm.collectionVariables.get('lang') || 'tr';",
									"  const slug = (first.slug && (first.slug[lang] || first.slug.en)) || first.slugCanonical;",
									"  if (slug && !pm.collectionVariables.get('recipeSlug')) pm.collectionVariables.set('recipeSlug', String(slug));",
									"}"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "x-lang",
								"value": "{{lang}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/recipes?fields=category&limit=120",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"recipes"
							],
							"query": [
								{
									"key": "fields",
									"value": "category"
								},
								{
									"key": "limit",
									"value": "120"
								}
							]
						},
						"description": "Public liste: q, tag, maxTime, limit senaryolarƒ±nƒ± test eder."
					},
					"response": []
				},
				{
					"name": "List Recipes Tags",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status 200\", function () { pm.response.to.have.status(200); });",
									"const json = pm.response.json();",
									"pm.test(\"Has data array\", function(){ pm.expect(Array.isArray(json.data)).to.be.true; });",
									"if (Array.isArray(json.data) && json.data.length) {",
									"  const first = json.data[0];",
									"  if (first._id && !pm.collectionVariables.get('recipeId')) pm.collectionVariables.set('recipeId', String(first._id));",
									"  const lang = pm.collectionVariables.get('lang') || 'tr';",
									"  const slug = (first.slug && (first.slug[lang] || first.slug.en)) || first.slugCanonical;",
									"  if (slug && !pm.collectionVariables.get('recipeSlug')) pm.collectionVariables.set('recipeSlug', String(slug));",
									"}"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "x-lang",
								"value": "{{lang}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/recipes?fields=tags&limit=120",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"recipes"
							],
							"query": [
								{
									"key": "fields",
									"value": "tags"
								},
								{
									"key": "limit",
									"value": "120"
								}
							]
						},
						"description": "Public liste: q, tag, maxTime, limit senaryolarƒ±nƒ± test eder."
					},
					"response": []
				},
				{
					"name": "List Recipes Tags Copy",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status 200\", function () { pm.response.to.have.status(200); });",
									"const json = pm.response.json();",
									"pm.test(\"Has data array\", function(){ pm.expect(Array.isArray(json.data)).to.be.true; });",
									"if (Array.isArray(json.data) && json.data.length) {",
									"  const first = json.data[0];",
									"  if (first._id && !pm.collectionVariables.get('recipeId')) pm.collectionVariables.set('recipeId', String(first._id));",
									"  const lang = pm.collectionVariables.get('lang') || 'tr';",
									"  const slug = (first.slug && (first.slug[lang] || first.slug.en)) || first.slugCanonical;",
									"  if (slug && !pm.collectionVariables.get('recipeSlug')) pm.collectionVariables.set('recipeSlug', String(slug));",
									"}"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "x-lang",
								"value": "{{lang}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/recipes?tag=dinner&limit=12",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"recipes"
							],
							"query": [
								{
									"key": "tag",
									"value": "dinner"
								},
								{
									"key": "limit",
									"value": "12"
								}
							]
						},
						"description": "Public liste: q, tag, maxTime, limit senaryolarƒ±nƒ± test eder."
					},
					"response": []
				},
				{
					"name": "Public: Submit Recipe (x-api-key)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.collectionVariables.set('ts', Date.now());"
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status 201\", function(){ pm.response.to.have.status(201); });",
									"var j = pm.response.json() || {};",
									"pm.expect(j.success).to.eql(true);",
									"var id = j && j.data && (j.data._id || j.data.id);",
									"if (id) pm.collectionVariables.set('recipeId', id);",
									"var slugCan = j && j.data && j.data.slugCanonical;",
									"if (slugCan) pm.collectionVariables.set('recipeSlug', slugCan);"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "x-api-key",
								"value": "{{api_key}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"title\": \"Mercimek √áorbasƒ±\",\n  \"category\": \"soup\",\n  \"totalMinutes\": 35,\n  \"servings\": 6,\n  \"calories\": 220,\n  \"ingredientsText\": \"1 su bardaƒüƒ± kƒ±rmƒ±zƒ± mercimek\\n1 adet soƒüan (yemeklik)\\n1 adet havu√ß (rendelenmi≈ü)\\n1 yemek ka≈üƒ±ƒüƒ± tereyaƒüƒ± veya 2 yemek ka≈üƒ±ƒüƒ± zeytinyaƒüƒ±\\n1 yemek ka≈üƒ±ƒüƒ± un (opsiyonel)\\n6 su bardaƒüƒ± su veya et suyu\\n1 tatlƒ± ka≈üƒ±ƒüƒ± kimyon (opsiyonel)\\nTuz, karabiber, pul biber\",\n  \"stepsText\": \"Soƒüan ve havucu yaƒüda yumu≈üayana dek kavurun (un kullanacaksanƒ±z ekleyip 1 dk kavurun).\\nYƒ±kanmƒ±≈ü mercimek ve suyu ekleyip kaynatƒ±n.\\nKƒ±sƒ±k ate≈üte 20‚Äì25 dakika pi≈üirin.\\nBlenderdan ge√ßirip kƒ±vamƒ±nƒ± ayarlayƒ±n.\\nTuz ve baharatlarƒ± ekleyin; limonla servis edin.\",\n  \"description\": \"Klasik, p√ºr√ºzs√ºz kƒ±vamlƒ±, restoran usul√º mercimek √ßorbasƒ±.\"\n}\n"
						},
						"url": {
							"raw": "{{base_url}}/recipes/submit",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"recipes",
								"submit"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get Recipe by Slug",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"if (!pm.collectionVariables.get('recipeSlug')) {",
									"  postman.setNextRequest(null);",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status 200\", function () { pm.response.to.have.status(200); });",
									"const json = pm.response.json();",
									"pm.test(\"Has data\", function(){ pm.expect(json.data).to.be.an('object'); });"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "x-lang",
								"value": "{{lang}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/recipes/{{recipeSlug}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"recipes",
								"{{recipeSlug}}"
							]
						},
						"description": "Public detay: slug ile eri≈üim."
					},
					"response": []
				}
			]
		},
		{
			"name": "Comments (Recipe)",
			"item": [
				{
					"name": "List Comments for Recipe",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"if (!pm.collectionVariables.get('recipeId')) {",
									"  postman.setNextRequest(null);",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status 200\", () => pm.response.to.have.status(200));",
									"const json = pm.response.json();",
									"pm.test(\"Has pagination\", () => pm.expect(json.pagination).to.be.an('object'));"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "x-lang",
								"value": "{{lang}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/comments/recipe/{{recipeId}}?page=1&limit=50",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"comments",
								"recipe",
								"{{recipeId}}"
							],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "50"
								}
							]
						},
						"description": "Bir tarifin yayƒ±nlanmƒ±≈ü yorumlarƒ± (public)."
					},
					"response": []
				},
				{
					"name": "Create Comment (Guest, Valid)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"if (!pm.collectionVariables.get('recipeId')) {",
									"  postman.setNextRequest(null);",
									"}"
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status 201\", () => pm.response.to.have.status(201));",
									"const json = pm.response.json();",
									"pm.test(\"Has created data\", () => pm.expect(json.data && json.data._id).to.exist);"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "x-lang",
								"value": "{{lang}}"
							},
							{
								"key": "x-dev-skip-captcha",
								"value": "dev-bypass-123",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"text\": \"Kƒ±vam harika oldu, limonla efsane!\",\n  \"name\": \"Ay≈üe\",\n  \"email\": \"ayse@example.com\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/comments/recipe/{{recipeId}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"comments",
								"recipe",
								"{{recipeId}}"
							]
						},
						"description": "Misafir olarak yorum olu≈üturur. ensureActor ile request i√ßinde kimlik atanƒ±r."
					},
					"response": []
				},
				{
					"name": "NEGATIVE: Create Comment (Invalid payload)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"if (!pm.collectionVariables.get('recipeId')) {",
									"  postman.setNextRequest(null);",
									"}"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status 400/422\", function(){",
									"  pm.expect([400,422]).to.include(pm.response.code);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "x-lang",
								"value": "{{lang}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"text\": \"ok\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/comments/recipe/{{recipeId}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"comments",
								"recipe",
								"{{recipeId}}"
							]
						},
						"description": "Eksik/yanlƒ±≈ü payload (2 karakter) ‚Üí 400 beklenir."
					},
					"response": []
				}
			]
		},
		{
			"name": "Reactions (Recipe)",
			"item": [
				{
					"name": "Toggle LIKE (on)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"if (!pm.collectionVariables.get('recipeId')) { postman.setNextRequest(null); }"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"201 or 200\", () => pm.expect([200,201]).to.include(pm.response.code));",
									"const json = pm.response.json();",
									"pm.test(\"on field exists\", () => pm.expect(json.data && typeof json.data.on !== 'undefined').to.be.true);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "x-lang",
								"value": "{{lang}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"recipeId\": \"{{recipeId}}\",\n  \"kind\": \"LIKE\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/reactions/toggle",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"reactions",
								"toggle"
							]
						},
						"description": "LIKE a√ß/kapa ‚Äî ilk √ßaƒürƒ±da a√ßar (on:true)."
					},
					"response": []
				},
				{
					"name": "Toggle LIKE (off)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "x-lang",
								"value": "{{lang}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"recipeId\": \"{{recipeId}}\",\n  \"kind\": \"LIKE\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/reactions/toggle",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"reactions",
								"toggle"
							]
						},
						"description": "LIKE tekrar √ßaƒürƒ±lƒ±nca kapatƒ±r."
					},
					"response": []
				},
				{
					"name": "Toggle EMOJI ‚ù§Ô∏è",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "x-lang",
								"value": "{{lang}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"recipeId\": \"{{recipeId}}\",\n  \"kind\": \"EMOJI\",\n  \"emoji\": \"‚ù§Ô∏è\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/reactions/toggle",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"reactions",
								"toggle"
							]
						},
						"description": "Kalp emojisi a√ß/kapa."
					},
					"response": []
				},
				{
					"name": "Set EMOJI üòã (on)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "x-lang",
								"value": "{{lang}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"recipeId\": \"{{recipeId}}\",\n  \"kind\": \"EMOJI\",\n  \"emoji\": \"üòã\",\n  \"on\": true\n}"
						},
						"url": {
							"raw": "{{base_url}}/reactions/set",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"reactions",
								"set"
							]
						},
						"description": "Idempotent on/off ‚Äî a√ßƒ±k hale getirir."
					},
					"response": []
				},
				{
					"name": "Set EMOJI üòã (off)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "x-lang",
								"value": "{{lang}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"recipeId\": \"{{recipeId}}\",\n  \"kind\": \"EMOJI\",\n  \"emoji\": \"üòã\",\n  \"on\": false\n}"
						},
						"url": {
							"raw": "{{base_url}}/reactions/set",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"reactions",
								"set"
							]
						},
						"description": "Idempotent on/off ‚Äî kapatƒ±r."
					},
					"response": []
				},
				{
					"name": "Rate ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ (5)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "x-lang",
								"value": "{{lang}}"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"recipeId\": \"{{recipeId}}\",\n  \"value\": 5\n}"
						},
						"url": {
							"raw": "{{base_url}}/reactions/rate",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"reactions",
								"rate"
							]
						},
						"description": "Misafir de rate verebilir (ensureActor)."
					},
					"response": []
				},
				{
					"name": "Summary (kind+emoji)",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "x-lang",
								"value": "{{lang}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/reactions/summary?recipeId={{recipeId}}&breakdown=kind+emoji",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"reactions",
								"summary"
							],
							"query": [
								{
									"key": "recipeId",
									"value": "{{recipeId}}"
								},
								{
									"key": "breakdown",
									"value": "kind+emoji"
								}
							]
						},
						"description": "Toplamlar ve kƒ±rƒ±lƒ±m."
					},
					"response": []
				},
				{
					"name": "My Reactions",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "x-lang",
								"value": "{{lang}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/reactions/me?recipeIds={{recipeId}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"reactions",
								"me"
							],
							"query": [
								{
									"key": "recipeIds",
									"value": "{{recipeId}}"
								}
							]
						},
						"description": "Kullanƒ±cƒ±nƒ±n (veya misafirin) kendi reaksiyonlarƒ±."
					},
					"response": []
				}
			]
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:5020/api",
			"type": "string"
		},
		{
			"key": "lang",
			"value": "tr",
			"type": "string"
		},
		{
			"key": "recipeId",
			"value": "",
			"type": "string"
		},
		{
			"key": "recipeSlug",
			"value": "",
			"type": "string"
		},
		{
			"key": "categoryId",
			"value": "",
			"type": "string"
		},
		{
			"key": "categorySlug",
			"value": "",
			"type": "string"
		},
		{
			"key": "ts",
			"value": ""
		}
	]
}